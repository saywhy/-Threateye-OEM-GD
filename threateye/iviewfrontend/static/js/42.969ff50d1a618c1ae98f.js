webpackJsonp([42],{Ya6d:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("UeIv"),n=a("5Xf9"),i={name:"message-container",data:function(){return{title_name:"通知消息",multipleSelection:[],news_data:{page:1,rows:10,data:[]}}},components:{backTitle:s.a},created:function(){this.get_news(),this.check_passwd()},mounted:function(){},methods:{check_passwd:function(){var e=this;this.$axios.get("/yiiapi/site/check-passwd-reset").then(function(t){var a=t.data,s=a.status,i=a.msg;a.data;"602"==s&&(e.$message({message:i,type:"warning"}),n.a.$emit("reset"))})},random:function(e,t){return Math.floor(Math.random()*(t-e+1))+e},get_news:function(){var e=this;this.$axios.get("/yiiapi/news/list",{params:{page:this.news_data.page,rows:this.news_data.rows,status:""}}).then(function(t){var a=t.data,s=(a.status,a.data);e.news_data.data=s}).catch(function(e){console.log(e)})},update:function(e,t){var a=this;this.$axios.get("/yiiapi/news/update",{params:{id:e}}).then(function(e){var s=e.data,i=s.status,o=(s.data,s.msg);switch(i){case 1:a.$message({message:o,type:"error"});break;case 0:switch(a.get_news(),t){case"1":n.a.$emit("reset");break;case"2":a.$router.push({path:"/system/licence"});break;case"3":a.$router.push({path:"/handle/works"})}break;default:a.$message({message:o,type:"error"})}}).catch(function(e){console.log(e)})},batch_marking:function(){var e=this;if(console.log(this.multipleSelection),0==this.multipleSelection.length)return this.$message({message:"请选择需要标记的消息",type:"warning"}),!1;var t=[];this.multipleSelection.forEach(function(e){t.push(1*e.id)}),this.$axios.put("/yiiapi/news/change-status",{id:t}).then(function(t){var a=t.data,s=a.status,n=(a.data,a.msg);switch(console.log(s),console.log(n),e.$refs.multipleTable.clearSelection(),s){case 1:e.$message({message:n,type:"error"});break;case 0:e.get_news(),e.$message({message:"标记成功",type:"success"});break;default:e.$message({message:n,type:"error"})}}).catch(function(e){console.log(e)})},del:function(){var e=this;if(console.log(this.multipleSelection),0==this.multipleSelection.length)return this.$message({message:"请选择需要删除的消息",type:"warning"}),!1;this.$confirm("此操作删除信息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t=[];e.multipleSelection.forEach(function(e){t.push(1*e.id)}),e.$axios.delete("/yiiapi/news/del",{data:{id:t}}).then(function(t){var a=t.data,s=a.status,n=(a.data,a.msg);switch(console.log(s),console.log(n),e.$refs.multipleTable.clearSelection(),s){case 1:e.$message({message:n,type:"error"});break;case 0:e.get_news(),e.$message({message:"删除成功",type:"success"});break;default:e.$message({message:n,type:"error"})}}).catch(function(e){console.log(e)})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},detail:function(e,t){switch(console.log(e),e.type){case"1":this.update(e.id,"1");break;case"2":this.update(e.id,"2");break;case"3":this.update(e.id,"3")}},toggleSelection:function(e){var t=this;e?e.forEach(function(e){t.$refs.multipleTable.toggleRowSelection(e)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange:function(e){this.multipleSelection=e},handleSizeChange:function(e){this.news_data.rows=e,this.news_data.page=1,this.get_news()},handleCurrentChange:function(e){this.news_data.page=e,this.get_news()}}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"message-container"},[a("back-title",{attrs:{"title-name":e.title_name}}),e._v(" "),a("div",{staticClass:"message-content"},[a("el-row",{staticClass:"message-top"},[a("el-col",{attrs:{span:24}},[a("div",[a("el-button",{staticClass:"e-btn e-btn-read",on:{click:e.batch_marking}},[e._v("标为已读")]),e._v(" "),a("el-button",{staticClass:"e-btn e-btn-remove",on:{click:e.del}},[e._v("删除")])],1)])],1),e._v(" "),a("el-row",{staticClass:"message-bottom common-table-pattern"},[a("el-col",{attrs:{span:24}},[a("el-table",{ref:"multipleTable",staticClass:"common-table",attrs:{align:"center",border:"",data:e.news_data.data.data},on:{"row-click":e.detail,"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{label:" ",align:"center",prop:"type",width:"20"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("div",{directives:[{name:"show",rawName:"v-show",value:"1"==e.row.status,expression:"scope.row.status=='1'"}],staticClass:"new_dot"})]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center",type:"selection",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{label:"时间",align:"center",width:"200","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("time")(t.row.created_at)))]}}])}),e._v(" "),a("el-table-column",{attrs:{width:"240",align:"center",label:"消息来源","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return["1"==t.row.type?a("span",[e._v("密码")]):e._e(),e._v(" "),"2"==t.row.type?a("span",[e._v("许可证")]):e._e(),e._v(" "),"3"==t.row.type?a("span",[e._v("工单")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"content",align:"center",label:"描述"}})],1)],1),e._v(" "),a("el-col",{staticClass:"e-pagination",attrs:{span:24}},[a("el-pagination",{attrs:{"current-page":e.news_data.data.pageNow,"page-sizes":[10,20,50,100],"page-size":10,total:e.news_data.data.count,layout:"total, sizes, prev, pager, next"},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)],1)],1)},staticRenderFns:[]};var l=a("VU/8")(i,o,!1,function(e){a("uvtJ")},"data-v-2416ada6",null);t.default=l.exports},uvtJ:function(e,t){}});