webpackJsonp([7],{"5eDA":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("mvHQ"),i=s.n(a),l=s("PJh5"),o=s.n(l),n=s("5Xf9"),r={name:"user_management",data:function(){return{loading:!1,user_list:{},user_data:{page:1,rows:10,placeholder:"",password:{}},user_state:{add:!1,edit:!1},user_add:{username:"",password:"",Re_password:"",department:"",mobile:"",email_addr:"",role:"",allow_ip:"",role_list:[]},user_edit:{password:"",Re_password:"",department:"",mobile:"",email_addr:"",role:"",id:"",allow_ip:"",role_list:[]},token_data:"",select_list:[]}},props:{option:{type:Object,default:function(){}}},mounted:function(){this.get_data(),this.check_passwd(),this.role_list(),this.get_menu(),this.getPwdLength()},methods:{check_passwd:function(){var e=this;this.$axios.get("/yiiapi/site/check-passwd-reset").then(function(t){var s=t.data,a=s.status,i=s.msg;s.data;if(0!=a)for(var l in i)600==l&&e.$message({message:i[l],type:"warning"}),602==l&&(e.$message({message:i[l],type:"warning"}),n.a.$emit("reset"))})},edit_pswd:function(){var e=this;this.$axios.get("/yiiapi/site/get-self-password-reset-token").then(function(t){var s=t.data,a=s.status,i=s.data;console.log(a),console.log(i.data.token);var l=i.data.token;e.$axios.post("/yiiapi/site/reset-self-password?token="+l,{ResetPasswordForm:{password:"Hoohoolab*1234",mobile:"151111211111",mail_addr:"12312312@qq.com",department:"123"},old_password:"Hoohoolab*123"}).then(function(e){var t=e.data,s=t.status,a=t.data;console.log(s),console.log(a)}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})},get_menu:function(){this.$axios.get("/yiiapi/site/menu").then(function(e){console.log(e)}).catch(function(e){console.log(e)})},get_data:function(){var e=this;this.loading=!0,this.$axios.get("/yiiapi/user/page",{params:{page:this.user_data.page,rows:this.user_data.rows}}).then(function(t){e.loading=!1,console.log(t),e.user_list=t.data.data,e.user_list.data.forEach(function(e,t){e.index_cn=t+1})}).catch(function(e){console.log(e)})},role_list:function(){var e=this;this.$axios.get("/yiiapi/user/role-list",{params:{page:1,rows:999}}).then(function(t){console.log(t),e.user_add.role_list=t.data.data.data,e.user_edit.role_list=t.data.data.data}).catch(function(e){console.log(e)})},getPwdLength:function(){var e=this;this.$axios.get("/yiiapi/site/get-passwd-length").then(function(t){console.log(t),e.user_data.password=t.data.data,e.user_data.placeholder="请输入包含大写、小写、数字和特殊字符其中三项,"+t.data.data.min_passwd_len+"-"+t.data.data.max_passwd_len+"位密码"}).catch(function(e){console.log(e)})},regex:function(e){return new RegExp("(?=.*[0-9])(?=.*[a-zA-Z])(?=.*[^a-zA-Z0-9])").test(e)},add_user:function(){var e=this;return""==this.user_add.username?(this.$message({message:"请输入用户名",type:"warning"}),!1):""==this.user_add.password?(this.$message({message:"请输入密码",type:"warning"}),!1):this.user_add.password!=this.user_add.Re_password?(this.$message({message:"两次输入密码不一致",type:"warning"}),!1):this.regex(this.user_add.password)?void this.$axios.post("/yiiapi/user/user-add",{username:this.user_add.username,password:this.user_add.password,role:this.user_add.role,department:this.user_add.department,allow_ip:this.user_add.allow_ip,mobile:this.user_add.mobile,email_addr:this.user_add.email_addr}).then(function(t){console.log(t),1==t.data.status?e.$message({message:t.data.msg,type:"error"}):0==t.data.status&&(e.get_data(),e.user_state.add=!1,e.$message({message:"添加用户成功",type:"success"}))}).catch(function(e){console.log(e)}):(this.$message({message:"密码必须同时包含大写、小写、数字和特殊字符其中三项",type:"warning"}),!1)},add_box:function(){this.user_state.add=!0,this.user_add.username="",this.user_add.password="",this.user_add.Re_password="",this.user_add.department="",this.user_add.mobile="",this.user_add.email_addr="",this.user_add.role="",this.user_add.allow_ip="",this.getPwdLength(),this.role_list()},edit_box:function(e){this.getPwdLength(),this.role_list(),this.user_state.edit=!0,console.log(e);var t=i()(e);this.user_edit.department=JSON.parse(t).department,this.user_edit.mobile=JSON.parse(t).mobile,this.user_edit.email_addr=JSON.parse(t).email_addr,this.user_edit.role=JSON.parse(t).role,this.user_edit.allow_ip=JSON.parse(t).allow_ip,this.user_edit.id=JSON.parse(t).id},edit_user:function(){var e=this;return console.log(this.user_edit),this.user_edit.password!=this.user_edit.Re_password?(this.$message({message:"两次输入密码不一致",type:"warning"}),!1):this.regex(this.user_edit.password)||""==this.user_edit.password?void this.$axios.get("/yiiapi/user/get-password-reset-token",{params:{id:this.user_edit.id}}).then(function(t){console.log(t.data),e.token_data=t.data.data,localStorage.setItem("token",t.data.data.token),e.$axios.put("/yiiapi/user/reset-password?token="+localStorage.getItem("token"),{ResetPasswordForm:{password:e.user_edit.password,allow_ip:e.user_edit.allow_ip,role:e.user_edit.role,email_addr:e.user_edit.email_addr,mobile:e.user_edit.mobile,department:e.user_edit.department}}).then(function(t){e.user_state.edit=!1,0==t.data.status?(e.get_data(),e.$message({message:"修改用户成功",type:"success"})):e.$message({message:t.data.msg,type:"error"})}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)}):(this.$message({message:"密码必须同时包含大写、小写、数字和特殊字符其中三项",type:"warning"}),!1)},del_user:function(){var e=this;if(console.log(this.select_list),0==this.select_list.length)return this.$message({message:"请选择需要删除的用户！",type:"warning"}),!1;this.$confirm("此操作删除信息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t=[];e.select_list.forEach(function(e){t.push(e.id)}),e.$axios.delete("/yiiapi/user/user-del",{data:{id:t}}).then(function(t){console.log(t),0==t.data.status?(e.get_data(),e.$message({message:"删除成功！",type:"success"})):e.$message({message:"删除失败！",type:"error"})}).catch(function(e){console.log(e)})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},handleSizeChange:function(e){this.user_data.rows=e,this.user_data.page=1,this.get_data()},handleCurrentChange:function(e){this.user_data.page=e,this.get_data()},handleSelectionChange:function(e){this.select_list=e},alert_detail:function(){},closed_add_box:function(){this.user_state.add=!1},closed_edit_box:function(){this.user_state.edit=!1}},filters:{formatDate:function(e){return o()(e).format("YYYY-MM-DD HH:mm:ss")}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.loading,expression:"loading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{id:"user_management"}},[a("div",{staticClass:"user_title"},[a("el-button",{staticClass:"btn_i",attrs:{type:"primary"},on:{click:e.add_box}},[e._v("新增")]),e._v(" "),a("el-button",{staticClass:"btn_o",attrs:{type:"primary"},on:{click:e.del_user}},[e._v("删除")])],1),e._v(" "),a("div",{staticClass:"user_table"},[a("el-table",{ref:"multipleTable",staticClass:"reset_table",staticStyle:{width:"100%"},attrs:{align:"center",border:"",data:e.user_list.data,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange,"row-click":e.alert_detail}},[a("el-table-column",{attrs:{type:"selection",align:"center",width:"50"}}),e._v(" "),a("el-table-column",{attrs:{label:"序号",align:"center",width:"50","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s((e.user_data.page-1)*e.user_data.rows+t.row.index_cn)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"username",align:"center",label:"用户名","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"department",align:"center",label:"部门",width:"120","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"email_addr",align:"center",label:"邮箱","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"role",align:"center",label:"角色",width:"120","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"creatorname",align:"center",width:"120",label:"创建人","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{label:"创建时间",width:"180","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("formatDate")(1e3*t.row.updated_at)))]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"btn_edit",attrs:{type:"primary"},on:{click:function(s){return s.stopPropagation(),e.edit_box(t.row)}}},[e._v("编辑")])]}}])})],1),e._v(" "),a("el-pagination",{staticClass:"pagination_box",attrs:{"current-page":e.user_list.pageNow,"page-sizes":[10,20,50,100],"page-size":10,layout:"total, sizes, prev, pager, next",total:e.user_list.count},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{staticClass:"add_box pop_box",attrs:{"close-on-click-modal":!1,"modal-append-to-body":!1,visible:e.user_state.add},on:{"update:visible":function(t){return e.$set(e.user_state,"add",t)}}},[a("img",{staticClass:"closed_img",attrs:{src:s("6an9"),alt:""},on:{click:e.closed_add_box}}),e._v(" "),a("div",{staticClass:"title"},[a("div",{staticClass:"mask"}),e._v(" "),a("span",{staticClass:"title_name"},[e._v("添加用户")])]),e._v(" "),a("div",{staticClass:"content"},[a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[e._v("用户名")]),e._v(" "),a("span",{staticClass:"red"},[e._v("*")])]),e._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请输入用户名",clearable:""},model:{value:e.user_add.username,callback:function(t){e.$set(e.user_add,"username",t)},expression:"user_add.username"}})],1),e._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[e._v("密码")]),e._v(" "),a("span",{staticClass:"red"},[e._v("*")])]),e._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:e.user_data.placeholder,"show-password":""},model:{value:e.user_add.password,callback:function(t){e.$set(e.user_add,"password",t)},expression:"user_add.password"}})],1),e._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[e._v("确认密码")]),e._v(" "),a("span",{staticClass:"red"},[e._v("*")])]),e._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请确认密码","show-password":""},model:{value:e.user_add.Re_password,callback:function(t){e.$set(e.user_add,"Re_password",t)},expression:"user_add.Re_password"}})],1),e._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[e._v("邮箱")]),e._v(" "),a("span",{staticClass:"red"},[e._v("*")])]),e._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请输入邮箱",clearable:""},model:{value:e.user_add.email_addr,callback:function(t){e.$set(e.user_add,"email_addr",t)},expression:"user_add.email_addr"}})],1),e._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[e._v("手机号")]),e._v(" "),a("span",{staticClass:"red"},[e._v("*")])]),e._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请输入手机号",clearable:""},model:{value:e.user_add.mobile,callback:function(t){e.$set(e.user_add,"mobile",t)},expression:"user_add.mobile"}})],1),e._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[e._v("部门")])]),e._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请输入部门",clearable:""},model:{value:e.user_add.department,callback:function(t){e.$set(e.user_add,"department",t)},expression:"user_add.department"}})],1),e._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[e._v("角色")])]),e._v(" "),a("el-select",{staticClass:"select_box",attrs:{placeholder:"请选择角色"},model:{value:e.user_add.role,callback:function(t){e.$set(e.user_add,"role",t)},expression:"user_add.role"}},e._l(e.user_add.role_list,function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})}),1)],1)]),e._v(" "),a("div",{staticClass:"btn_box"},[a("el-button",{staticClass:"cancel_btn",on:{click:e.closed_add_box}},[e._v("取消")]),e._v(" "),a("el-button",{staticClass:"ok_btn",on:{click:e.add_user}},[e._v("确定")])],1)]),e._v(" "),a("el-dialog",{staticClass:"add_box pop_box",attrs:{"close-on-click-modal":!1,"modal-append-to-body":!1,visible:e.user_state.edit},on:{"update:visible":function(t){return e.$set(e.user_state,"edit",t)}}},[a("img",{staticClass:"closed_img",attrs:{src:s("6an9"),alt:""},on:{click:e.closed_edit_box}}),e._v(" "),a("div",{staticClass:"title"},[a("div",{staticClass:"mask"}),e._v(" "),a("span",{staticClass:"title_name"},[e._v("编辑用户")])]),e._v(" "),a("div",{staticClass:"content"},[a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[e._v("密码")])]),e._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:e.user_data.placeholder,"show-password":""},model:{value:e.user_edit.password,callback:function(t){e.$set(e.user_edit,"password",t)},expression:"user_edit.password"}})],1),e._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[e._v("确认密码")])]),e._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请再次输入密码","show-password":""},model:{value:e.user_edit.Re_password,callback:function(t){e.$set(e.user_edit,"Re_password",t)},expression:"user_edit.Re_password"}})],1),e._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[e._v("邮箱")]),e._v(" "),a("span",{staticClass:"red"},[e._v("*")])]),e._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请输入邮箱",clearable:""},model:{value:e.user_edit.email_addr,callback:function(t){e.$set(e.user_edit,"email_addr",t)},expression:"user_edit.email_addr"}})],1),e._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[e._v("手机号")]),e._v(" "),a("span",{staticClass:"red"},[e._v("*")])]),e._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请输入手机号",clearable:""},model:{value:e.user_edit.mobile,callback:function(t){e.$set(e.user_edit,"mobile",t)},expression:"user_edit.mobile"}})],1),e._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[e._v("部门")])]),e._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请输入部门",clearable:""},model:{value:e.user_edit.department,callback:function(t){e.$set(e.user_edit,"department",t)},expression:"user_edit.department"}})],1),e._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[e._v("角色")])]),e._v(" "),a("el-select",{staticClass:"select_box",attrs:{placeholder:"请选择角色"},model:{value:e.user_edit.role,callback:function(t){e.$set(e.user_edit,"role",t)},expression:"user_edit.role"}},e._l(e.user_edit.role_list,function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})}),1)],1)]),e._v(" "),a("div",{staticClass:"btn_box"},[a("el-button",{staticClass:"cancel_btn",on:{click:e.closed_edit_box}},[e._v("取消")]),e._v(" "),a("el-button",{staticClass:"ok_btn",on:{click:e.edit_user}},[e._v("确定")])],1)])],1)},staticRenderFns:[]};var d=s("VU/8")(r,c,!1,function(e){s("w+hA"),s("NeJh")},"data-v-1226e448",null).exports,_={name:"role_management",data:function(){return{data:[{id:1,label:"首页",children:[{id:2,label:"总览"}]},{id:13,label:"处置",children:[{id:14,label:"资产维度"},{id:23,label:"风险维度",children:[{id:24,label:"外部威胁"},{id:32,label:"横向威胁"},{id:40,label:"外联威胁"}]},{id:48,label:"工单中心"}]},{id:58,label:"告警",children:[{id:59,label:"告警"}]},{id:76,label:"追查",children:[{id:77,label:"DNS追查"},{id:81,label:"IP/URL追查"},{id:85,label:"主机追查"},{id:93,label:"用户追查"},{id:97,label:"文件追查"},{id:101,label:"数据传输追查"},{id:105,label:"流量方向追查"},{id:109,label:"IOC扫描器"}]},{id:123,label:"报表",children:[{id:124,label:"报表生成"},{id:130,label:"报表发送"}]},{id:132,label:"系统",children:[{id:133,label:"设备管理"},{id:139,label:"受监控IP"},{id:144,label:"账号管理"},{id:157,label:"网络配置"},{id:162,label:"系统选项"},{id:169,label:"规则库及白名单"},{id:183,label:"联动"},{id:187,label:"威胁通知"},{id:191,label:"日志"},{id:204,label:"恢复/重启"},{id:207,label:"许可证"}]}],defaultProps:{children:"children",label:"label"},role_list:{},role_data:{page:1,rows:10},role_state:{add:!1,edit:!1},role_add:{name:"",describe:"",permissions_id:[]},role_edit:{},old_role_edit:"",select_list:[],loading:!1}},props:{option:{type:Object,default:function(){}}},mounted:function(){this.get_data(),this.get_version(),this.check_passwd()},methods:{check_passwd:function(){var e=this;this.$axios.get("/yiiapi/site/check-passwd-reset").then(function(t){var s=t.data,a=s.status,i=s.msg;s.data;if(0!=a)for(var l in i)600==l&&e.$message({message:i[l],type:"warning"}),602==l&&(e.$message({message:i[l],type:"warning"}),n.a.$emit("reset"))})},get_version:function(){var e=this;this.$axios.get("/yiiapi/site/license-version").then(function(t){var s=t.data,a=(s.status,s.data);console.log(a.edition),2==a.edition&&e.data.forEach(function(e){"追查"==e.label&&e.children.push({id:117,label:"沙箱"})})}).catch(function(e){console.log(e)})},get_data:function(){var e=this;this.loading=!0,this.$axios.get("/yiiapi/user/role-list",{params:{page:this.role_data.page,rows:this.role_data.rows}}).then(function(t){e.loading=!1,console.log(t.data),e.role_list=t.data.data,e.role_list.data.forEach(function(e,t){e.index_cn=t+1})}).catch(function(e){console.log(e)})},add_box:function(){this.role_state.add=!0,this.role_add.name="",this.role_add.describe="",this.role_add.permissions_id=[],this.resetChecked()},edit_box:function(e){var t=this;this.role_edit={},this.old_role_edit="",this.role_state.edit=!0,this.old_role_edit=i()(e),this.role_edit_cn=i()(e),this.role_edit=JSON.parse(this.role_edit_cn),console.log(this.role_edit),this.role_edit.permissions_id_cn=JSON.parse(this.role_edit.permissions_id),console.log(this.role_edit.permissions_id_cn);var s=[];this.role_edit.permissions_id_cn.forEach(function(e){1!=e&&13!=e&&23!=e&&123!=e&&76!=e&&132!=e&&58!=e&&s.push(e)}),this.$nextTick(function(){t.$refs.tree_edit.setCheckedKeys(s)})},handleSizeChange:function(e){this.role_data.rows=e,this.role_data.page=1,this.get_data()},handleCurrentChange:function(e){this.role_data.page=e,this.get_data()},closed_add_box:function(){this.role_state.add=!1},closed_edit_box:function(){this.role_state.edit=!1},add_role:function(){var e=this;return""==this.role_add.name?(this.$message({message:"请输入角色名称",type:"warning"}),!1):0==this.$refs.tree.getCheckedNodes().length?(this.$message({message:"请至少选择一项角色权限",type:"warning"}),!1):(this.$refs.tree.getCheckedNodes().forEach(function(t){e.role_add.permissions_id.push(t.id)}),this.$refs.tree.getHalfCheckedNodes().forEach(function(t){e.role_add.permissions_id.push(t.id)}),this.loading=!0,void this.$axios.post("/yiiapi/user/add-role",{name:this.role_add.name,description:this.role_add.describe,permissions_id:this.role_add.permissions_id}).then(function(t){e.loading=!1,console.log(t),0==t.data.status&&(e.role_state.add=!1,e.get_data(),e.$message({message:"添加角色成功",type:"success"}))}).catch(function(e){console.log(e)}))},edit_role:function(){var e=this;return console.log(this.role_edit),this.role_edit.permissions_id_edit=[],""==this.role_edit.name?(this.$message({message:"请输入角色名称",type:"warning"}),!1):0==this.$refs.tree_edit.getCheckedNodes().length?(this.$message({message:"请至少选择一项角色权限",type:"warning"}),!1):(this.$refs.tree_edit.getCheckedNodes().forEach(function(t){e.role_edit.permissions_id_edit.push(t.id)}),this.$refs.tree_edit.getHalfCheckedNodes().forEach(function(t){e.role_edit.permissions_id_edit.push(t.id)}),void this.$axios.post("/yiiapi/user/edit-role",{id:this.role_edit.id,old_name:JSON.parse(this.old_role_edit).name,name:this.role_edit.name,description:this.role_edit.description,permissions_id:this.role_edit.permissions_id_edit}).then(function(t){console.log(t),0==t.data.status?(e.role_state.edit=!1,e.get_data(),e.$message({message:"修改角色成功！",type:"success"})):1==t.data.status&&e.$message({message:t.data.msg,type:"error"})}).catch(function(e){console.log(e)}))},del_role:function(){var e=this;if(console.log(this.select_list),0==this.select_list.length)return this.$message({message:"请选择需要删除的角色！",type:"warning"}),!1;this.$confirm("此操作删除信息, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t=[];e.select_list.forEach(function(e){t.push(e.name)}),e.$axios.delete("/yiiapi/user/del-role",{data:{role_name:t}}).then(function(t){console.log(t.data),0==t.data.status?(e.get_data(),e.$message({message:"删除成功！",type:"success"})):e.$message({message:t.data.msg,type:"error"})}).catch(function(e){console.log(e)})}).catch(function(){e.$message({type:"info",message:"已取消删除"})})},handleSelectionChange:function(e){this.select_list=e},checkSelectable:function(e){return"SYSTEM"!=e.creatorname},getCheckedKeys:function(){console.log(this.$refs.tree.getCheckedKeys())},setCheckedNodes:function(){},setCheckedKeys:function(){},resetChecked:function(){this.$refs.tree.setCheckedKeys([])}},filters:{formatDate:function(e){return o()(e).format("YYYY-MM-DD HH:mm:ss")}}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.loading,expression:"loading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{id:"role_management"}},[a("div",{staticClass:"role_title"},[a("el-button",{staticClass:"btn_i",attrs:{type:"primary"},on:{click:e.add_box}},[e._v("新增")]),e._v(" "),a("el-button",{staticClass:"btn_o",attrs:{type:"primary"},on:{click:e.del_role}},[e._v("删除")])],1),e._v(" "),a("div",{staticClass:"role_table"},[a("el-table",{ref:"multipleTable",staticClass:"reset_table",staticStyle:{width:"100%"},attrs:{align:"center",border:"",data:e.role_list.data,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",align:"center",selectable:e.checkSelectable,width:"50"}}),e._v(" "),a("el-table-column",{attrs:{prop:"index",align:"center",label:"序号",width:"50","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s((e.role_data.page-1)*e.role_data.rows+t.row.index_cn)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",align:"center",label:"角色名称",width:"180","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"description",align:"center",label:"角色描述","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{label:"创建时间",align:"center",width:"220","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("formatDate")(1e3*t.row.created_at)))]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"creatorname",align:"center",label:"创建人",width:"180","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return["SYSTEM"!=t.row.creatorname?a("el-button",{staticClass:"btn_edit",attrs:{type:"primary"},on:{click:function(s){return s.stopPropagation(),e.edit_box(t.row)}}},[e._v("编辑")]):e._e()]}}])})],1),e._v(" "),a("el-pagination",{staticClass:"pagination_box",attrs:{"current-page":e.role_list.pageNow,"page-sizes":[10,20,50,100],"page-size":10,layout:"total, sizes, prev, pager, next",total:e.role_list.count},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{staticClass:"add_box pop_box",attrs:{"close-on-click-modal":!1,"modal-append-to-body":!1,visible:e.role_state.add},on:{"update:visible":function(t){return e.$set(e.role_state,"add",t)}}},[a("img",{staticClass:"closed_img",attrs:{src:s("6an9"),alt:""},on:{click:e.closed_add_box}}),e._v(" "),a("div",{staticClass:"title"},[a("div",{staticClass:"mask"}),e._v(" "),a("span",{staticClass:"title_name"},[e._v("添加角色")])]),e._v(" "),a("div",{staticClass:"content"},[a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[e._v("角色名称")]),e._v(" "),a("span",{staticClass:"red_necessary"},[e._v("*")])]),e._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请输入角色名称",clearable:""},model:{value:e.role_add.name,callback:function(t){e.$set(e.role_add,"name",t)},expression:"role_add.name"}})],1),e._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[e._v("角色权限")]),e._v(" "),a("span",{staticClass:"red_necessary"},[e._v("*")])]),e._v(" "),a("el-tree",{ref:"tree",attrs:{data:e.data,"show-checkbox":"","highlight-current":"","node-key":"id",props:e.defaultProps,"default-expand-all":!1}})],1),e._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[e._v("角色描述")])]),e._v(" "),a("el-input",{staticClass:"select_box",attrs:{type:"textarea",rows:2,autosize:"",resize:"none",placeholder:"请输入角色描述"},model:{value:e.role_add.describe,callback:function(t){e.$set(e.role_add,"describe",t)},expression:"role_add.describe"}})],1)]),e._v(" "),a("div",{staticClass:"btn_box"},[a("el-button",{staticClass:"cancel_btn",on:{click:e.closed_add_box}},[e._v("取消")]),e._v(" "),a("el-button",{staticClass:"ok_btn",on:{click:e.add_role}},[e._v("确定")])],1)]),e._v(" "),a("el-dialog",{staticClass:"add_box pop_box",attrs:{"close-on-click-modal":!1,"modal-append-to-body":!1,visible:e.role_state.edit},on:{"update:visible":function(t){return e.$set(e.role_state,"edit",t)}}},[a("img",{staticClass:"closed_img",attrs:{src:s("6an9"),alt:""},on:{click:e.closed_edit_box}}),e._v(" "),a("div",{staticClass:"title"},[a("div",{staticClass:"mask"}),e._v(" "),a("span",{staticClass:"title_name"},[e._v("编辑角色")])]),e._v(" "),a("div",{staticClass:"content"},[a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[e._v("角色名称")]),e._v(" "),a("span",{staticClass:"red_necessary"},[e._v("*")])]),e._v(" "),a("el-input",{staticClass:"select_box",attrs:{placeholder:"请输入角色名称",clearable:""},model:{value:e.role_edit.name,callback:function(t){e.$set(e.role_edit,"name",t)},expression:"role_edit.name"}})],1),e._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[e._v("角色权限")]),e._v(" "),a("span",{staticClass:"red_necessary"},[e._v("*")])]),e._v(" "),a("el-tree",{ref:"tree_edit",attrs:{data:e.data,"show-checkbox":"","highlight-current":"","node-key":"id",props:e.defaultProps,"default-expand-all":!1}})],1),e._v(" "),a("div",{staticClass:"content_item"},[a("p",[a("span",{staticClass:"title"},[e._v("角色描述")])]),e._v(" "),a("el-input",{staticClass:"select_box",attrs:{type:"textarea",rows:4,autosize:"",resize:"none",placeholder:"请输入角色描述"},model:{value:e.role_edit.description,callback:function(t){e.$set(e.role_edit,"description",t)},expression:"role_edit.description"}})],1)]),e._v(" "),a("div",{staticClass:"btn_box"},[a("el-button",{staticClass:"cancel_btn",on:{click:e.closed_edit_box}},[e._v("取消")]),e._v(" "),a("el-button",{staticClass:"ok_btn",on:{click:e.edit_role}},[e._v("确定")])],1)])],1)},staticRenderFns:[]};var p=s("VU/8")(_,u,!1,function(e){s("x8rZ"),s("935S")},"data-v-0eea1a20",null).exports,m={name:"security_policy",data:function(){return{security_policy:{},security_policy_status:{loading:!1,switch:!0}}},props:{option:{type:Object,default:function(){}}},mounted:function(){this.get_data(),this.check_passwd()},methods:{check_passwd:function(){var e=this;this.$axios.get("/yiiapi/site/check-passwd-reset").then(function(t){var s=t.data,a=s.status,i=s.msg;s.data;if(0!=a)for(var l in i)600==l&&e.$message({message:i[l],type:"warning"}),602==l&&(e.$message({message:i[l],type:"warning"}),n.a.$emit("reset"))})},get_data:function(){var e=this;this.security_policy_status.loading=!0,this.$axios.get("/yiiapi/securitypolicy/get-security-policy").then(function(t){console.log(t),e.security_policy=t.data.data,"1"==e.security_policy.status?e.security_policy_status.switch=!0:e.security_policy_status.switch=!1,e.security_policy_status.loading=!1}).catch(function(e){console.log(e)})},set_data:function(){var e=this;this.security_policy_status.switch?this.security_policy.status="1":this.security_policy.status="0",console.log(this.security_policy),this.$axios.put("/yiiapi/securitypolicy/set-security-policy",{min_passwd_len:this.security_policy.min_passwd_len,max_passwd_len:this.security_policy.max_passwd_len,passwd_regular_edit_time:this.security_policy.passwd_regular_edit_time,admin_faild_logon_time:this.security_policy.admin_faild_logon_time,admin_logon_delay_time:this.security_policy.admin_logon_delay_time,session_timeout:this.security_policy.session_timeout,admin_online_count:this.security_policy.admin_online_count,status:this.security_policy.status}).then(function(t){console.log(t),0==t.data.status?(e.get_data(),e.$message({message:"修改成功！",type:"success"})):e.$message.error({message:t.data.msg,type:"error"})}).catch(function(e){console.log(e)})},reset_data:function(){this.get_data()},handleChange_pswd_min:function(){},handleChange_pswd_max:function(){}}},h={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.security_policy_status.loading,expression:"security_policy_status.loading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{id:"security_policy"}},[s("div",{staticClass:"top"},[s("span",[e._v("是否启用:")]),e._v(" "),s("el-switch",{model:{value:e.security_policy_status.switch,callback:function(t){e.$set(e.security_policy_status,"switch",t)},expression:"security_policy_status.switch"}})],1),e._v(" "),s("div",{staticClass:"mid"},[s("div",{staticClass:"mid_item"},[s("p",{staticClass:"title item_color"},[e._v("密码长度最小值：")]),e._v(" "),s("el-input-number",{staticClass:"input_box",attrs:{min:8,max:11,label:"请输入密码长度最小值"},on:{change:e.handleChange_pswd_min},model:{value:e.security_policy.min_passwd_len,callback:function(t){e.$set(e.security_policy,"min_passwd_len",t)},expression:"security_policy.min_passwd_len"}}),e._v(" "),s("span",{staticClass:"red"},[e._v("*")]),e._v(" "),s("span",{staticClass:"item_color"},[e._v("密码最小长度8-11之间包含大小写字母和数字")])],1),e._v(" "),s("div",{staticClass:"mid_item"},[s("p",{staticClass:"title item_color"},[e._v("密码长度最大值：")]),e._v(" "),s("el-input-number",{staticClass:"input_box",attrs:{min:11,max:30,label:"请输入密码长度最大值"},on:{change:e.handleChange_pswd_max},model:{value:e.security_policy.max_passwd_len,callback:function(t){e.$set(e.security_policy,"max_passwd_len",t)},expression:"security_policy.max_passwd_len"}}),e._v(" "),s("span",{staticClass:"red"},[e._v("*")]),e._v(" "),s("span",{staticClass:"item_color"},[e._v("密码最大长度11-30之间包含大小写字母和数字")])],1),e._v(" "),s("div",{staticClass:"mid_item"},[s("p",{staticClass:"title item_color"},[e._v("密码定期修改时间：")]),e._v(" "),s("el-input-number",{staticClass:"input_box",attrs:{min:1,max:90,label:"请输入密码定期修改时间"},model:{value:e.security_policy.passwd_regular_edit_time,callback:function(t){e.$set(e.security_policy,"passwd_regular_edit_time",t)},expression:"security_policy.passwd_regular_edit_time"}}),e._v(" "),s("span",{staticClass:"red"},[e._v("*")]),e._v(" "),s("span",{staticClass:"item_color"},[e._v("(1-90)天")])],1),e._v(" "),s("div",{staticClass:"mid_item"},[s("p",{staticClass:"title item_color"},[e._v("最大登录重试次数：")]),e._v(" "),s("el-input-number",{staticClass:"input_box",attrs:{min:1,max:5,label:"请输入最大登录重试次数"},model:{value:e.security_policy.admin_faild_logon_time,callback:function(t){e.$set(e.security_policy,"admin_faild_logon_time",t)},expression:"security_policy.admin_faild_logon_time"}}),e._v(" "),s("span",{staticClass:"red"},[e._v("*")]),e._v(" "),s("span",{staticClass:"item_color"},[e._v("(1-5)次")])],1),e._v(" "),s("div",{staticClass:"mid_item"},[s("p",{staticClass:"title item_color"},[e._v("登录失败阻断时间：")]),e._v(" "),s("el-input-number",{staticClass:"input_box",attrs:{min:1,max:3600,label:"请输入登录失败阻断时间"},model:{value:e.security_policy.admin_logon_delay_time,callback:function(t){e.$set(e.security_policy,"admin_logon_delay_time",t)},expression:"security_policy.admin_logon_delay_time"}}),e._v(" "),s("span",{staticClass:"red"},[e._v("*")]),e._v(" "),s("span",{staticClass:"item_color"},[e._v("(1-3600)秒")])],1),e._v(" "),s("div",{staticClass:"mid_item"},[s("p",{staticClass:"title item_color"},[e._v("页面超时时间：")]),e._v(" "),s("el-input-number",{staticClass:"input_box",attrs:{min:1,max:480,label:"请输入页面超时时间"},model:{value:e.security_policy.session_timeout,callback:function(t){e.$set(e.security_policy,"session_timeout",t)},expression:"security_policy.session_timeout"}}),e._v(" "),s("span",{staticClass:"red"},[e._v("*")]),e._v(" "),s("span",{staticClass:"item_color"},[e._v("(1-480)分钟")])],1),e._v(" "),s("div",{staticClass:"mid_item"},[s("p",{staticClass:"title item_color"},[e._v("同时在线数：")]),e._v(" "),s("el-input-number",{staticClass:"input_box",attrs:{min:1,max:5,label:"请输入同时在线数"},model:{value:e.security_policy.admin_online_count,callback:function(t){e.$set(e.security_policy,"admin_online_count",t)},expression:"security_policy.admin_online_count"}}),e._v(" "),s("span",{staticClass:"red"},[e._v("*")]),e._v(" "),s("span",{staticClass:"item_color"},[e._v("(1-5)个")])],1)]),e._v(" "),s("div",{staticClass:"bottom"},[s("el-button",{staticClass:"btn_i",attrs:{type:"primary"},on:{click:e.set_data}},[e._v("保存")]),e._v(" "),s("el-button",{staticClass:"btn_o",attrs:{type:"primary"},on:{click:e.reset_data}},[e._v("取消")])],1)])},staticRenderFns:[]};var v={components:{userManagement:d,roleManagement:p,securityPolicy:s("VU/8")(m,h,!1,function(e){s("NNj0"),s("iCNJ")},"data-v-4768cbba",null).exports},name:"system_control_account",data:function(){return{activeName:"first",tab_show:{first:!0,second:!1,third:!1}}},mounted:function(){this.check_passwd()},methods:{check_passwd:function(){var e=this;this.$axios.get("/yiiapi/site/check-passwd-reset").then(function(t){var s=t.data,a=s.status,i=s.msg;s.data;if(0!=a)for(var l in i)600==l&&e.$message({message:i[l],type:"warning"}),602==l&&(e.$message({message:i[l],type:"warning"}),n.a.$emit("reset"))})},handleClick:function(e,t){switch(console.log(e),e.name){case"first":this.tab_show.first=!0,this.tab_show.second=!1,this.tab_show.third=!1;break;case"second":this.tab_show.first=!1,this.tab_show.second=!0,this.tab_show.third=!1;break;case"third":this.tab_show.first=!1,this.tab_show.second=!1,this.tab_show.third=!0}}}},g={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container",attrs:{id:"system_control_account"}},[s("div",{staticClass:"content_box"},[s("el-tabs",{staticClass:"reset_tab",on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[s("el-tab-pane",{staticClass:"tabs-item",attrs:{label:"用户管理",name:"first"}},[e.tab_show.first?s("user-management"):e._e()],1),e._v(" "),s("el-tab-pane",{staticClass:"tabs-item",attrs:{label:"角色管理",name:"second"}},[e.tab_show.second?s("role-management"):e._e()],1),e._v(" "),s("el-tab-pane",{staticClass:"tabs-item",attrs:{label:"用户安全策略",name:"third"}},[e.tab_show.third?s("security-policy"):e._e()],1)],1)],1)])},staticRenderFns:[]};var b=s("VU/8")(v,g,!1,function(e){s("FIwy"),s("m1pf")},"data-v-3def2d86",null);t.default=b.exports},"935S":function(e,t){},FIwy:function(e,t){},NNj0:function(e,t){},NeJh:function(e,t){},iCNJ:function(e,t){},m1pf:function(e,t){},"w+hA":function(e,t){},x8rZ:function(e,t){}});